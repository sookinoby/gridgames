"use strict";angular.module("road2mathApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","gridGame3App","gridGame1App"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"game/game1/views/main.html"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).when("/game/3",{templateUrl:"game/game3/views/main.html"}).when("/game/:type",{templateUrl:"game/game1/views/main.html"}).when("/game/:type",{templateUrl:"game/game1/views/main.html"}).when("/game/:type",{templateUrl:"game/game1/views/main.html"}).when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl"}).when("/home",{templateUrl:"views/main.html",controller:"MainCtrl"}).otherwise({redirectTo:"/login"})}]).run(["$rootScope","$location","$cookieStore","$http",function(a,b,c,d){a.globals=c.get("globals")||{},a.globals.currentUser&&(d.defaults.headers.common.Authorization="Basic "+a.globals.currentUser.authdata),a.$on("$locationChangeStart",function(c,d,e){"/login"===b.path()||a.globals.currentUser||b.path("/login")})}]),angular.module("road2mathApp").controller("MainCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("road2mathApp").controller("AboutCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),function(){angular.module("gridGame1App",["gridGame1","ngAnimate","ngCookies","timer","ngDropdowns","gridGame1Data"]).controller("gridGame1Controller",["GridGame1Manager","GridGame1KeyboardService","$scope","GridGame1DataService","$routeParams",function(a,b,c,d,e){2==e.type?this.gameType=2:this.gameType=1,this.game=a,this.gameData=null,this.timerToggleButton=!1,b.destroy(),b.init(),this.newGame=function(){this.game.newGame(this.gameData,c.ddSelectSelected.value),this.timedGame=this.timerToggleButton,this.game.gameOver=!1,c.$broadcast("timer-reset"),c.$broadcast("timer-reset-new","gameCountDown",5),this.titleOfStrategy=c.ddSelectSelected.text,this.shortTitleOfStrategy=c.ddSelectSelected.value},this.loadGameData=function(){var a=this,b=c,e=d.getGameData(this.gameType);e.then(function(c){a.initialiseDropDown(),a.gameData=c.data.GameData;for(var d=0;d<a.gameData.length;d++){var e={text:a.gameData[d].name,value:a.gameData[d].sname};b.ddSelectOptions.push(e)}a.newGame()})},c.ddSelectOptions=[],this.initialiseDropDown=function(){2==this.gameType&&(c.ddSelectSelected={text:"The Two Minute Challenge",value:"level1"},this.timerToggleButton=!0),1==this.gameType&&(c.ddSelectSelected={text:"The Add 0 Strategy",value:"A0"})},this.timedGame=!1,c.timerRunning=!1,this.startTimer=function(a){c.$broadcast("timer-start",a),c.timerRunning=!0},c.stopTimer=function(){c.$broadcast("timer-stop"),c.timerRunning=!1},this.countDown=function(){var a=this;c.$on("timer-stopped",function(b,d){c.$apply(function(){a.game.resetTimer(),"gameCountDown"==d.name?a.startTimer("gameTimer"):"gameTimer"==d.name&&a.timedGame&&(a.game.gameOver=!0)})})},this.initialiseCallBack=function(){var a=this;b.on(function(b){a.game.move(b).then(function(){})})},this.initialiseCallBack(),this.loadGameData(),this.countDown();var f=this;c.$watch("ddSelectSelected.text",function(a,b){null!=f.gameData&&f.newGame()})}])}(),function(){angular.module("gridGame1Grid",[]).factory("GridGameGenerateUniqueId",function(){var a=function(a){function b(){return(65536*(1+Math.random())||0).toString(16).substring(1)}var c=a||"-";return b()+b()+c+b()+c+b()+c+b()+c+b()+b()+b()};return{next:function(){return a()}}}).factory("GridGame1TileModel",["GridGameGenerateUniqueId",function(a){var b=function(b,c,d,e){this.x=b.x,this.y=b.y,this.value=c,this.answer=d,this.question=e,this.id=a.next(),this.merged=null,this.changeColor=!1,this.selected=!1,this["default"]=!0};return b.prototype.savePosition=function(){this.originalX=this.x,this.originalY=this.y},b.prototype.setChangeColor=function(){this["default"]=!1,this.changeColor=!0},b.prototype.resetChangeColor=function(){this["default"]=!0,this.changeColor=!1},b.prototype.setSelected=function(){this.selected=!0},b.prototype.getSelected=function(){return this.selected},b.prototype.resetSelected=function(){this.selected=!1},b.prototype.reset=function(){this.merged=null},b.prototype.setMergedBy=function(a){var b=this;a.forEach(function(a){a.merged=!0,a.updatePosition(b.getPosition())})},b.prototype.updateValue=function(a){this.value=a},b.prototype.updatePosition=function(a){this.x=a.x,this.y=a.y},b.prototype.getPosition=function(){return{x:this.x,y:this.y}},b}]).provider("GridGame1Service",function(){this.size=4,this.currentQuestionCells,this.selectedAnswer=[],this.showSubmitButton=null,this.showNextButton=null,this.linenumber=0,this.factContent,this.currentAnswersCells=[],this.setSize=function(a){this.size=a?a:0};var a=this;this.$get=["GridGame1TileModel",function(b){this.grid=[],this.tiles=[],this.gameData=[],this.nameOfStrategy=null,this.keysPressed=[];var c={left:{x:-1,y:0},right:{x:1,y:0},up:{x:0,y:-1},down:{x:0,y:1}};return this.indexOf=function(a){return"function"==typeof Array.prototype.indexOf?indexOf=Array.prototype.indexOf:indexOf=function(a){var b=-1,c=-1;for(b=0;b<this.length;b++)if(this[b]===a){c=b;break}return c},indexOf.call(this,a)},this.buildDataForGame=function(a,b){this.gameData=a,this.nameOfStrategy=b},this.buildEmptyGameBoard=function(){for(var b=this,c=0;c<a.size*a.size;c++)this.grid[c]=null;this.forEach(function(a,c){b.setCellAt({x:a,y:c},null)})},this.cleanupCells=function(){var a=this;this.forEach(function(b,c,d){d&&d.merged&&a.removeTile(d)})},this.setAnswerTile=function(a){this.correctAnswerTile.push(a)},this.getAnswerTile=function(){return this.correctAnswerTile},this.resetAnswerTile=function(a){this.correctAnswerTile=null},this.withinGrid=function(a){return a.x>=0&&a.x<this.size&&a.y>=0&&a.y<this.size},this._getRandom=function(a,b){return Math.floor(Math.random()*(b-a+1))+a},this.getOptions=function(a,b){for(var c=[],d=0;d<a.length;d++)c.push(a[d]);for(var d=0;d<4-a.length;d++){var e=this._getRandom(0,b.length-1),f=b.splice(e,1).toString();c.push(f)}return c},this.resetFactContent=function(){this.linenumber=0,this.factContent=[{fact:"-",select:!1,wrong:!1,right:!1,isAnswer:!1},{fact:"-",select:!1,wrong:!1,right:!1,isAnswer:!1},{fact:"-",select:!1,wrong:!1,right:!1,isAnswer:!1},{fact:"-",select:!1,wrong:!1,right:!1,isAnswer:!1}]},this.buildStartingPosition=function(a){var b=this.nameOfStrategy,c=null;if(null!=b){for(var d=0;d<this.gameData.length;d++)this.gameData[d].sname==b&&(c=this.gameData[d]);null==c&&(c=this.gameData[0])}else c=this.gameData[0];var e=this._getRandom(0,c.questions.length-1),f=c.questions[e].q,g=c.questions[e].a,h=c.questions[e].o;this.correctAnswerTile=[];var i=this.getOptions(g.slice(),h.slice()),j=this.randomlyInsertNewQuestionTile(f,a);this.points_for_questions=0;var k=this.findRelativeAvailableCells(j);return this.insertTileAtAdjacentPosition(k,i,g.length),this.currentQuestionCells=j,this.currentAnswersCells=k,k[0]},this.deleteCurrentBoard=function(){if(void 0!=this.currentAnswersCells&&null!=this.currentQuestionCells){this.showSubmitButton.truthValue=!1,this.showNextButton.truthValue=!1,this.keysPressed=[],this.removeTile(this.currentQuestionCells);for(var a=0;a<this.currentAnswersCells.length;a++)this.removeTile(this.currentAnswersCells[a]);this.currentAnswersCells=[],this.currentQuestionCells=null,this.resetAnswerTile()}},this.availableCells=function(){var a=[],b=this;return this.forEach(function(c,d){var e=b.getCellAt({x:c,y:d});e||a.push({x:c,y:d})}),a},this.getCellAt=function(a){if(this.withinGrid(a)){var b=this._coordinatesToPosition(a);return this.tiles[b]}return null},this.setCellAt=function(a,b){if(this.withinGrid(a)){var c=this._coordinatesToPosition(a);this.tiles[c]=b}},this.forEach=function(b){for(var c=a.size*a.size,d=0;c>d;d++){var e=this._positionToCoordinates(d);b(e.x,e.y,this.tiles[d])}},this._positionToCoordinates=function(b){var c=b%a.size,d=(b-c)/a.size;return{x:c,y:d}},this._coordinatesToPosition=function(b){return b.y*a.size+b.x},this.insertTile=function(a){var b=this._coordinatesToPosition(a);this.tiles[b]=a},this.newTile=function(a,c,d,e){return new b(a,c,d,e)},this.removeTile=function(a){a=this._coordinatesToPosition(a),this.tiles[a]=null},this.randomlyInsertNewQuestionTile=function(a,b){var c=null;c=null==b||b=={}?this.randomAvailableCell():b;var d=this.newTile(c,a,!1,!0);return this.insertTile(d),d},this.shuffle=function(a){for(var b,c,d=a.length;d;b=Math.floor(Math.random()*d),c=a[--d],a[d]=a[b],a[b]=c);return a},this.getFactContent=function(){return this.factContent},this.findRelativeAvailableCells=function(b){var c=b.x,d=b.y,e=[];return c+1<a.size&&e.push({x:c+1,y:d}),c-1>=0&&e.push({x:c-1,y:d}),d-1>=0&&e.push({x:c,y:d-1}),d+1<a.size&&e.push({x:c,y:d+1}),e},this.insertTileAtAdjacentPosition=function(a,b,c){a=this.shuffle(a);for(var d=0;d<a.length;d++){var e,f=a[d];e=c>d?this.newTile(f,b[d],!0,!1):this.newTile(f,b[d],!1,!1),e.resetChangeColor(),e.resetSelected(),e.answer&&this.setAnswerTile(e),this.insertTile(e)}},this.checkIfDuplicate=function(a){return-1==this.keysPressed.indexOf(a)?(this.keysPressed.push(a),-1):1},this.getCorrespondingArrowKey=function(b){var c,d="up",e="right",f="down",g="left",h=a.currentQuestionCells,i=h.x,j=h.y,k=b.x,l=b.y;i-k==1&&(c=g),i-k==-1&&(c=e),j-l==1&&(c=d),j-l==-1&&(c=f),-1==a.checkIfDuplicate(c)&&a.selectedAnswer.push(c)},this.selectTitleForProcessing=function(b,d){if(!a.showNextButton.truthValue){var e=a.currentQuestionCells,f=e.x,g=e.y;if(void 0===d||f!=d.x||g!=d.y){var h;if(void 0!==d){var i=d.x,j=d.y;h=d,a.getCorrespondingArrowKey(d)}else{var k=c[b],i=e.x+k.x,j=e.y+k.y;h=a.getCellAt({x:i,y:j})}return null==h?!1:h.getSelected()?!1:h.value==a.currentQuestionCells.value?!1:(h.setSelected(),a.showSubmitButton.truthValue=!0,this.linenumber>3?!1:(a.factContent[a.linenumber].fact=e.value+h.value,a.factContent[a.linenumber].select=!0,a.factContent[a.linenumber].isAnswer=h.answer,a.linenumber++,!0))}}},this.factContentColorChange=function(){for(var a=0;4>a;a++)1==this.factContent[a].select&&(1==this.factContent[a].isAnswer?this.factContent[a].right=!0:this.factContent[a].wrong=!0)},this.checkIfKeyPressAllowed=function(a){var b=c[a],d=this.currentQuestionCells,e=(d.x,d.y,d.x+b.x),f=d.y+b.y,g=this.getCellAt({x:e,y:f});return null==g?!1:!0},this.checkIfAnswerIsValid=function(){if(0==this.keysPressed.length)for(var a=this.getAnswerTile(),b=0;b<a.length;b++){var d=a[b];d.setChangeColor()}for(var b=0;b<this.keysPressed.length;b++){var e=c[this.keysPressed[b]],f=this.currentQuestionCells,g=(f.x,f.y,f.x+e.x),h=f.y+e.y,i=this.getCellAt({x:g,y:h});if(null!=i){var j=i.answer;if(0==j){i.setChangeColor();for(var a=this.getAnswerTile(),k=0;k<a.length;k++){var d=a[k];d.setChangeColor()}}else j&&(this.points_for_questions=this.points_for_questions+1,i.resetSelected(),i.setChangeColor())}}return this.factContentColorChange(),this.points_for_questions},this.passSubmitButton=function(a){this.showSubmitButton=a},this.passNextButton=function(a){this.showNextButton=a},this.getLineNumber=function(){return a.linenumber},this.randomAvailableCell=function(){var a=this.availableCells();return a.length>0?a[Math.floor(Math.random()*a.length)]:void 0},this.anyCellsAvailable=function(){return this.availableCells().length>0},this}]})}(),function(){angular.module("gridGame1Grid").directive("grid1",function(){return{restrict:"A",require:"ngModel",scope:{ngModel:"="},templateUrl:"game/game1/scripts/grid/grid.html",link:function(a){a.grid=a.ngModel.grid,a.tiles=a.ngModel.tiles}}})}(),function(){angular.module("gridGame1Grid").directive("tile1",["GridGame1Service",function(a){return{restrict:"A",scope:{ngModel:"="},templateUrl:"game/game1/scripts/grid/tile.html",link:function(b){b.selectTitleForProcessing=a.selectTitleForProcessing}}}])}(),angular.module("gridGame1Keyboard",[]).service("GridGame1KeyboardService",["$q","$document",function(a,b){var c="up",d="right",e="down",f="left",g="enter",h={37:f,38:c,39:d,40:e,13:g};this.init=function(){var a=this;b.bind("keydown",function(b){var c=h[b.which];c&&(b.preventDefault(),a._handleKeyEvent(c,b))})},this.destroy=function(){b.unbind("keydown")},this.keyEvents=null,this.on=function(a){this.keyEvents=a},this._handleKeyEvent=function(a,b){var c=this.keyEvents;if(c&&(b.preventDefault(),c)){var d=c;d(a,b)}}}]),function(){angular.module("gridGame1",["gridGame1Grid","gridGame1Keyboard","ngCookies","gridGame1Data"]).service("GridGame1Manager",["$q","$timeout","GridGame1Service","$cookieStore","$log",function(a,b,c,d,e){this.getHighScore=function(){return parseInt(d.get("highScore"))||0},this.positionToInsert={},this.grid=c.grid,this.tiles=c.tiles,this.gameOver=!1,this.showNextButton={},this.showSubmitButton={},this.showSubmitButton.truthValue=!1,this.showNextButton.truthValue=!1,this.stats=!0,this.passButton=function(){c.passSubmitButton(this.showSubmitButton),c.passNextButton(this.showNextButton)},this.passButton(),this.indexOf=function(a){return"function"==typeof Array.prototype.indexOf?indexOf=Array.prototype.indexOf:indexOf=function(a){var b=-1,c=-1;for(b=0;b<this.length;b++)if(this[b]===a){c=b;break}return c},indexOf.call(this,a)},this.factContent=[{fact:"1",select:!1,wrong:!1,right:!1},{fact:"-",select:!1,wrong:!1,right:!1},{fact:"-",select:!1,wrong:!1,right:!1},{fact:"-",select:!1,wrong:!1,right:!1}],this.rightAnswer=!1,this.netural=!0,this.resetTimer=function(){this.countdownfinished=!0},this.changeStats=function(){this.stats=!this.stats},this.reinit=function(){this.gameOver=!1,this.win=!1,this.currentScore=0,this.totalfacts=0,this.counter=1,this.countdownfinished=!1,this.highScore=this.getHighScore(),this.keypressed=[],this.enterKeyCount=0},this.reinit(),this.newGame=function(a,b){c.deleteCurrentBoard(),c.buildDataForGame(a,b),c.buildEmptyGameBoard(),this.positionToInsert=c.buildStartingPosition(),this.netural=!0,this.showSubmitButton.truthValue=!1,c.resetFactContent(),this.factContent=c.getFactContent(),this.reinit()},this.showNextQuestions=function(){this.keypressed=[],this.enterKeyCount=0,c.resetFactContent(),this.factContent=c.getFactContent(),c.deleteCurrentBoard(),this.positionToInsert=c.buildStartingPosition(this.positionToInsert),this.showNextButton.truthValue=!1,this.netural=!0,this.rightAnswer=!1},this.evaluateAnswer=function(){var a=c.checkIfAnswerIsValid(this.keypressed);null!=a&&a>0?(this.updateScore(this.currentScore+a),this.factContent=c.getFactContent(),this.rightAnswer=!0,this.netural=!1,this.counter++):(this.rightAnswer=!1,this.netural=!1),this.totalfacts++,this.showSubmitButton.truthValue=!1,this.showNextButton.truthValue=!0},this.move=function(b){var d=this,e=function(){if(d.countdownfinished){if(d.gameOver)return!0;if(d.win)return!1;if("enter"==b){if(0==c.getLineNumber())return;d.enterKeyCount++,1==d.enterKeyCount?d.evaluateAnswer():2==d.enterKeyCount&&d.showNextQuestions()}else 0==d.enterKeyCount&&-1==c.checkIfDuplicate(b)&&c.checkIfKeyPressAllowed(b)&&(d.showSubmitButton.truthValue=!0,c.selectTitleForProcessing(b),d.factContent=c.getFactContent())}};return a.when(e())},this.updateScore=function(a){this.currentScore=a,this.currentScore>this.getHighScore()&&(this.highScore=a,d.put("highScore",a))}}])}(),function(){var a=function(a,b){this.getGameData=function(c){var d=b.defer(),c="gamedata"+c+".json";return a.get("game/game1/scripts/game/"+c).then(function(a){d.resolve(a)}),d.promise}};a.$inject=["$http","$q"],angular.module("gridGame1Data",[]).service("GridGame1DataService",a)}(),function(){angular.module("gridGame3App",["gridGameThree","ngAnimate","ngCookies","timer","ngDropdowns","gridGameThreeGameData","ngRoute"]).controller("GameController",["GameManager","KeyboardService","$scope","gameDataService","$routeParams",function(a,b,c,d,e){this.gameType=3,this.game=a,this.gameData=null,this.timerToggleButton=!1,b.destroy(),b.init(),this.newGame=function(){this.game.newGame(this.gameData,c.ddSelectSelected.value),this.timedGame=this.timerToggleButton,this.game.gameOver=!1,c.$broadcast("timer-reset"),c.$broadcast("timer-reset-new","gameCountDown",5),this.titleOfStrategy=c.ddSelectSelected.text},this.loadGameData=function(){var a=this,b=c,e=d.getGameData(this.gameType);e.then(function(c){a.gameData=c.data.GameData;for(var d=0;d<a.gameData.length;d++){var e={text:a.gameData[d].name,value:a.gameData[d].sname};b.ddSelectOptions.push(e)}a.newGame()})},c.ddSelectOptions=[],c.ddSelectSelected={text:"Add Merge Bucket A0C1",value:"A0C1"},this.timedGame=!1,c.timerRunning=!1,this.startTimer=function(a){c.$broadcast("timer-start",a),c.timerRunning=!0},c.stopTimer=function(){c.$broadcast("timer-stop"),c.timerRunning=!1},this.countDown=function(){var a=this;c.$on("timer-stopped",function(b,d){c.$apply(function(){a.game.resetTimer(),"gameCountDown"==d.name?a.startTimer("gameTimer"):"gameTimer"==d.name&&a.timedGame&&(a.game.gameOver=!0)})})},this.initialiseCallBack=function(){var a=this;b.on(function(b){a.game.move(b).then(function(){})})},this.initialiseCallBack(),this.loadGameData(),this.countDown();var f=this;c.$watch("ddSelectSelected.text",function(a,b){null!=f.gameData&&f.newGame()})}])}(),angular.module("gridGameThreeGrid",["gridGameThreeGameData"]).factory("GenerateUniqueId",["gameDataService",function(a){this.dataFromFile=a.getGameData("3");var b=function(a){function b(){return(65536*(1+Math.random())||0).toString(16).substring(1)}var c=a||"-";return b()+b()+c+b()+c+b()+c+b()+c+b()+b()+b()};return{next:function(){return b()}}}]).factory("TileModel",["GenerateUniqueId",function(a){var b=function(b,c,d){this.x=b.x,this.y=b.y,this.value=c||2,this.id=a.next(),this.merged=null,this.selected=!1,this.answer=d,this.colorchange=!1};return b.prototype.savePosition=function(){this.originalX=this.x,this.originalY=this.y},b.prototype.flip=function(){this.selected=!this.selected},b.prototype.setChangeColor=function(){this["default"]=!1,this.changeColor=!0},b.prototype.resetChangeColor=function(){this["default"]=!0,this.changeColor=!1},b.prototype.setSelected=function(){this.selected=!0},b.prototype.resetSelected=function(){this.selected=!1},b.prototype.reset=function(){this.merged=null},b.prototype.setMergedBy=function(a){var b=this;a.forEach(function(a){a.merged=!0,a.updatePosition(b.getPosition())})},b.prototype.updateValue=function(a){this.value=a},b.prototype.updatePosition=function(a){this.x=a.x,this.y=a.y},b.prototype.getPosition=function(){return{x:this.x,y:this.y}},b}]).service("GridService",["TileModel","gameDataService",function(a,b){var c=b.getGameData("3");this.dataFromFile=null,this.linenumber=0,this.factContent;var d=this;c.then(function(a){d.dataFromFile=a.data.GameData}),this.size=4,this.startingTiles=12,this.row=3,this.column=4,this.setSize=function(a){this.size=a?a:0},this.setStartingTiles=function(a){this.startingTiles=a},this.storeSelectedPositions=[],this.grid=[],this.tiles=[],this.gameData=[],this.nameOfStrategy=null,this.showSubmitButton=null,this.questionToDisplay=null,this.showNextButton=null;var e={left:{x:-1,y:0},right:{x:1,y:0},up:{x:0,y:-1},down:{x:0,y:1}};return this.buildDataForGame=function(a,b){this.gameData=a,this.nameOfStrategy=b},this.buildEmptyGameBoard=function(){for(var a=this,b=0;b<d.row*d.column;b++)this.grid[b]=null;this.forEach(function(b,c){a.setCellAt({x:b,y:c},null)})},this.setAnswerTile=function(a){this.correctAnswerTile.push(a)},this.getAnswerTile=function(){return this.correctAnswerTile},this.resetAnswerTile=function(a){this.correctAnswerTile=[]},this.indexOf=function(a){return"function"==typeof Array.prototype.indexOf?indexOf=Array.prototype.indexOf:indexOf=function(a){var b=-1,c=-1;for(b=0;b<this.length;b++)if(this[b]===a){c=b;break}return c},indexOf.call(this,a)},this.withinGrid=function(a){return a.x>=0&&a.x<this.column&&a.y>=0&&a.y<this.row},this._getRandom=function(a,b){return Math.floor(Math.random()*(b-a+1))+a},this.resetFactContent=function(){this.linenumber=0,this.factContent=[{fact:"-",select:!1,wrong:!1,right:!1,isAnswer:!1},{fact:"-",select:!1,wrong:!1,right:!1,isAnswer:!1},{fact:"-",select:!1,wrong:!1,right:!1,isAnswer:!1}]},this.buildStartingPosition=function(){var a=this.nameOfStrategy,b=null;if(null!=a){for(var c=0;c<this.gameData.length;c++)this.gameData[c].sname==a&&(b=this.gameData[c]);null==b&&(b=this.gameData[0])}else b=this.gameData[0];var d=this._getRandom(0,b.questions.length-1),e=b.questions[d].q,f=b.questions[d].a,g=b.questions[d].o;this.correctAnswerTile=[],this.questionToDisplay.question=e,this.insertTileInOrder(g,f)},this.deleteCurrentBoard=function(){this.storeSelectedPositions=[],this.showNextButton.truthValue=!1,this.showSubmitButton.truthValue=!1;for(var a=0;a<this.row;a++)for(var b=0;b<this.column;b++)this.removeTile({x:b,y:a});this.currentAnswersCells=[],this.currentQuestionCells=null,this.resetAnswerTile()},this.insertTileInOrder=function(a,b){for(var c=[],d=0;d<this.row;d++)for(var e=0;e<this.column;e++)c.push({x:e,y:d});for(var f=0;f<a.length;f++){var g,h=c[f];-1===b.indexOf(a[f])?g=this.newTile(h,a[f],!1,!1):(g=this.newTile(h,a[f],!0,!1),this.setAnswerTile(g)),g.resetChangeColor(),g.resetSelected(),this.insertTile(g)}},this.availableCells=function(){var a=[],b=this;return this.forEach(function(c,d){var e=b.getCellAt({x:c,y:d});e||a.push({x:c,y:d})}),a},this.tileMatchesAvailable=function(){for(var a=d.size*d.size,b=0;a>b;b++){var c=this._positionToCoordinates(b),f=this.tiles[b];if(f)for(var g in e){var h=e[g],i={x:c.x+h.x,y:c.y+h.y},j=this.getCellAt(i);if(j&&j.value===f.value)return!0}}return!1},this.getCellAt=function(a){if(this.withinGrid(a)){var b=this._coordinatesToPosition(a);return this.tiles[b]}return null},this.setCellAt=function(a,b){if(this.withinGrid(a)){var c=this._coordinatesToPosition(a);this.tiles[c]=b}},this.moveTile=function(a,b){var c={x:a.x,y:a.y};this.setCellAt(c,null),this.setCellAt(b,a),a.updatePosition(b)},this.forEach=function(a){for(var b=d.row*d.column,c=0;b>c;c++){var e=this._positionToCoordinates(c);a(e.x,e.y,this.tiles[c])}},this._positionToCoordinates=function(a){var b=a%d.size,c=(a-b)/d.size;return{x:b,y:c}},this._coordinatesToPosition=function(a){return a.y*d.size+a.x},this.insertTile=function(a){var b=this._coordinatesToPosition(a);this.tiles[b]=a},this.newTile=function(b,c,d){return new a(b,c,d)},this.removeTile=function(a){a=this._coordinatesToPosition(a),this.tiles[a]=null},this.samePositions=function(a,b){return a.x===b.x&&a.y===b.y},this.randomlyInsertNewTile=function(){var a=this.randomAvailableCell(),b=this.newTile(a,2);this.insertTile(b)},this.randomAvailableCell=function(){var a=this.availableCells();return a.length>0?a[Math.floor(Math.random()*a.length)]:void 0},this.getFactContent=function(){return this.factContent},this.setFactContent=function(){return this.factContent},this.factContentColorChange=function(){for(var a=0;a<this.factContent.length;a++)1==this.factContent[a].select&&(1==this.factContent[a].isAnswer?this.factContent[a].right=!0:this.factContent[a].wrong=!0)},this.clone=function(a){var b;if(null==a||"object"!=typeof a)return a;if(a instanceof Date)return b=new Date,b.setTime(a.getTime()),b;if(a instanceof Array){b=[];for(var c=0,d=a.length;d>c;c++)b[c]=this.clone(a[c]);return b}if(a instanceof Object){b={};for(var e in a)a.hasOwnProperty(e)&&(b[e]=this.clone(a[e]));return b}throw new Error("Unable to copy obj! Its type isn't supported.")},this.storeAnswer=function(a){if(!d.showNextButton.truthValue){var b,c;b=a.x,c=a.y;var e=d._coordinatesToPosition({x:b,y:c}),f=d.storeSelectedPositions.indexOf(e);if(-1==f){if(3==d.linenumber)return;a.flip(),d.storeSelectedPositions.push(d._coordinatesToPosition({x:b,y:c}));var g=d.getCellAt({x:b,y:c});d.factContent[d.linenumber].fact=g.value,d.factContent[d.linenumber].select=!0,d.factContent[d.linenumber].isAnswer=g.answer,d.linenumber++}else{d.storeSelectedPositions.splice(f,1),a.flip();for(var g=d.getCellAt({x:b,y:c}),h=0;h<d.factContent.length;h++)d.factContent[h].fact==g.value&&(d.factContent[h].fact="-",d.factContent[h].select=!1,d.factContent[h].isAnswer=!1,d.linenumber--);for(var i=d.clone(d.factContent),j=0,k=d.factContent.length,h=0;h<d.factContent.length;h++)"-"!=d.factContent[h].fact&&(i[j].fact=d.factContent[h].fact,i[j].select=d.factContent[h].select,console.log(i[j].fact),console.log(i[j].select),j++);for(var h=0;j>h;h++)d.factContent[h].fact=i[h].fact,d.factContent[h].select=i[h].select;for(var l=j;k>l;l++)d.factContent[l].fact="-",d.factContent[l].select=!1,d.factContent[l].isAnswer=!1}0!==d.storeSelectedPositions.length?d.showSubmitButton.truthValue=!0:d.showSubmitButton.truthValue=!1}},this.evaluateAnswer=function(){for(var a=0;a<this.storeSelectedPositions.length;a++){var b=this._positionToCoordinates(this.storeSelectedPositions[a]),c=this.getCellAt({x:b.x,y:b.y}),d=0;if(null!=c){var e=c.answer;if(0==e){c.setChangeColor();for(var f=this.getAnswerTile(),g=0;g<f.length;g++){var h=f[g];h.setChangeColor()}}else e&&(d+=1,c.resetSelected(),c.setChangeColor())}}return console.log(d),this.factContentColorChange(),d},this.toShowSubmitButton=function(a){this.showSubmitButton=a},this.toShowQuestion=function(a){this.questionToDisplay=a},this.toShowNextButton=function(a){this.showNextButton=a},this.isAnswerSelected=function(){return 0!==this.storeSelectedPositions.length},this.anyCellsAvailable=function(){return this.availableCells().length>0},this}]),angular.module("gridGameThreeGrid").directive("grid",function(){return{restrict:"A",require:"ngModel",scope:{ngModel:"="},templateUrl:"game/game3/scripts/grid/grid.html",link:function(a){a.grid=a.ngModel.grid,a.tiles=a.ngModel.tiles}}}),angular.module("gridGameThreeGrid").directive("tile",["GridService",function(a){return{restrict:"A",scope:{ngModel:"="},templateUrl:"game/game3/scripts/grid/tile.html",link:function(b){b.storeAnswer=a.storeAnswer}}}]),angular.module("gridGameThreeKeyboard",[]).service("KeyboardService",["$q","$document",function(a,b){var c="up",d="right",e="down",f="left",g="enter",h={37:f,38:c,39:d,40:e,13:g};this.init=function(){var a=this;b.bind("keydown",function(b){var c=h[b.which];c&&(b.preventDefault(),a._handleKeyEvent(c,b))})},this.destroy=function(){b.unbind("keydown")},this.keyEvents=null,this.on=function(a){this.keyEvents=a},this._handleKeyEvent=function(a,b){var c=this.keyEvents;if(c&&(b.preventDefault(),c)){var d=c;d(a,b)}}}]),angular.module("gridGameThree",["gridGameThreeGrid","gridGameThreeKeyboard","ngCookies"]).service("GameManager",["$q","$timeout","GridService","KeyboardService","$cookieStore",function(a,b,c,d,e){this.getHighScore=function(){return parseInt(e.get("highScore"))||0},this.grid=c.grid,this.tiles=c.tiles,this.storeAnswer=c.storeAnswer,this.stats=!0,this.showNextButton={},this.showSubmitButton={},this.showSubmitButton.truthValue=!1,this.showNextButton.truthValue=!1,this.questionToDisplay={},this.enterCount=0,this.totalfacts=0,this.rightAnswer=!1,this.netural=!0,this.indexOf=function(a){return"function"==typeof Array.prototype.indexOf?indexOf=Array.prototype.indexOf:indexOf=function(a){var b=-1,c=-1;for(b=0;b<this.length;b++)if(this[b]===a){c=b;break}return c},indexOf.call(this,a)},this.resetTimer=function(){this.countdownfinished=!0},this.changeStats=function(){this.stats=!this.stats},this.passButton=function(){c.toShowSubmitButton(this.showSubmitButton),c.toShowNextButton(this.showNextButton)},this.passButton(),this.evaluateAnswer=function(){var a=c.evaluateAnswer();this.showSubmitButton.truthValue=!1,this.showNextButton.truthValue=!0,a>0?(this.rightAnswer=!0,this.netural=!1,this.updateScore(a)):(this.netural=!1,this.rightAnswer=!1)},this.showNextQuestions=function(){this.totalfacts=this.totalfacts+1,c.deleteCurrentBoard(),c.buildStartingPosition(),c.resetFactContent(),this.factContent=c.getFactContent(),this.rightAnswer=!1,this.netural=!0,this.showNextButton.truthValue=!1,this.showSubmitButton.truthValue=!1},this.reinit=function(){this.gameOver=!1,this.win=!1,this.currentScore=0,this.totalfacts=0,this.highScore=this.getHighScore(),this.countdownfinished=!1,this.showSubmitButton.truthValue=!1,this.enterCount=0,this.rightAnswer=!1,this.netural=!0},this.reinit(),this.newGame=function(a,b){this.questionToDisplay={},c.resetFactContent(),c.deleteCurrentBoard(),c.toShowQuestion(this.questionToDisplay),c.buildDataForGame(a,b),c.buildEmptyGameBoard(),c.buildStartingPosition(),this.factContent=c.getFactContent(),this.reinit()},this.move=function(b){var d=this,e=function(){return d.win?!1:void("enter"==b&&(d.enterCount++,1==c.isAnswerSelected()?(1==d.enterCount&&d.evaluateAnswer(),2==d.enterCount&&(d.showNextQuestions(),d.enterCount=0)):d.enterCount=0))};return a.when(e())},this.updateScore=function(a){this.currentScore=this.currentScore+a,this.currentScore>this.getHighScore()&&(this.highScore=this.currentScore+a,e.put("highScore",a))}}]),function(){var a=function(a,b){this.getGameData=function(c){var d=b.defer(),c="gamedata"+c+".json";return a.get("game/game3/scripts/game3/"+c).then(function(a){d.resolve(a)}),d.promise}};a.$inject=["$http","$q"],angular.module("gridGameThreeGameData",[]).service("gameDataService",a)}(),angular.module("road2mathApp").factory("AuthenticationService",["Base64","$http","$cookieStore","$rootScope","$timeout",function(a,b,c,d,e){var f={};return f.Login=function(a,b,c){e(function(){var d={success:"login"===a&&"test"===b};d.success||(d.message="Username or password is incorrect"),c(d)},1e3)},f.SetCredentials=function(e,f){var g=a.encode(e+":"+f);d.globals={currentUser:{username:e,authdata:g}},b.defaults.headers.common.Authorization="Basic "+g,c.put("globals",d.globals)},f.ClearCredentials=function(){d.globals={},c.remove("globals"),b.defaults.headers.common.Authorization="Basic "},f}]).factory("Base64",function(){var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return{encode:function(b){var c,d,e,f,g,h="",i="",j="",k=0;do c=b.charCodeAt(k++),d=b.charCodeAt(k++),i=b.charCodeAt(k++),e=c>>2,f=(3&c)<<4|d>>4,g=(15&d)<<2|i>>6,j=63&i,isNaN(d)?g=j=64:isNaN(i)&&(j=64),h=h+a.charAt(e)+a.charAt(f)+a.charAt(g)+a.charAt(j),c=d=i="",e=f=g=j="";while(k<b.length);return h},decode:function(b){var c,d,e,f,g,h="",i="",j="",k=0,l=/[^A-Za-z0-9\+\/\=]/g;l.exec(b)&&window.alert("There were invalid base64 characters in the input text.\nValid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='\nExpect errors in decoding."),b=b.replace(/[^A-Za-z0-9\+\/\=]/g,"");do e=a.indexOf(b.charAt(k++)),f=a.indexOf(b.charAt(k++)),g=a.indexOf(b.charAt(k++)),j=a.indexOf(b.charAt(k++)),c=e<<2|f>>4,d=(15&f)<<4|g>>2,i=(3&g)<<6|j,h+=String.fromCharCode(c),64!=g&&(h+=String.fromCharCode(d)),64!=j&&(h+=String.fromCharCode(i)),c=d=i="",e=f=g=j="";while(k<b.length);return h}}}),angular.module("road2mathApp").controller("LoginCtrl",["$scope","$rootScope","$location","AuthenticationService",function(a,b,c,d){d.ClearCredentials(),a.login=function(){a.dataLoading=!0,d.Login(a.username,a.password,function(b){b.success?(d.SetCredentials(a.username,a.password),c.path("/")):(a.error=b.message,a.dataLoading=!1)})}}]);